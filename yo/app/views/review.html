<view-title>{{::review.title}} - {{::review.tagValues}}</view-title>


<div class="video-information {{pluginNames.join(' ')}} {{::review.mediaType}} {{mediaPlayer.playerControls.wideMode ? 'col-md-7' : 'col-md-5'}}">

	<div class="background-white contextual-information">
		<span class="close" ng-click="hideContextualInfo()">&times;</span>
		<div class="content"></div>
	</div>

	<div class="background-white">

		<!-- The media player -->
		<media-player review="::review" config="::mediaPlayer" ng-class=":reviewRefresh:pluginNames"></media-player>	
		
		<!-- The video information -->
		<!-- Almost no optimization done, could win max ~70 watchers -->
		<div ng-class="pluginNames">
			<form class="container-fluid video-details" name="videoInformationForm" ng-class=":reviewRefresh:{'editing': review.editing}">
				<div class="row">
					<div class="col-md-12">
						<div class="row video-information-header">

							<div class="col-md-12 review-header" ng-if="!review.editing">
								<span class="skill-level" ng-if=":reviewRefresh:review.participantDetails.skillLevel">
									<img class="skill-level-icon" src="{{:reviewRefresh:getSkillLevelSource(review)}}" title="{{:reviewRefresh:getSkillLevelLabel(review)}}">
								</span>
								<h1 class="video-title" ng-model="review.title">{{:reviewRefresh:review.title}}</h1>
								<img class="visibility" ng-class=":reviewRefresh:review.visibility" ng-if=":reviewRefresh:(review.visibility && review.visibility != 'public')" title="{{ 'global.review.visibility.' + review.visibility + 'Tooltip' | translate }}" src="{{ config.images['visibility' + review.visibility] }}" />
							</div>
							<div class="col-md-12 review-header editing" ng-if="review.editing">
								<div class="metadata">
									<participants-details review="review" hide-participants="true"></participants-details>
									<hs-decklist-upload sport="sport" review="review"></hs-decklist-upload>
									<review-visibility review="review"></review-visibility>
								</div>
								<div class="title">
									<div class="form-group review-editing-title" show-errors="{ showSuccess: true }">
										<input type="text" name="title" class="form-control" ng-model="review.title" placeholder="{{ 'global.review.comment.reviewTitle' | translate }}" ng-required="true">
									</div>
								</div>
							</div>

							<div class="col-md-12" ng-if="!review.editing">
								<div class="row meta-info">
									<div class="author-row">
										<div class="author-information">
											<span>Submitted <span title="{{formatExactDate(review.creationDate)}}">{{formatDate(review.creationDate)}}</span> by </span>
											<span class="comment-author" ng-if="!review.authorId">{{review.author}}</span>
											<author-name class="comment-author" entity="review" ng-if="review.authorId"></author-name>
											<span bs-tooltip data-title="{{review.author}}'s total reputation on {{review.sport.value}}" data-placement="bottom" data-animation="am-fade-and-scale" class="total-reputation" ng-if="review.authorReputation">{{review.authorReputation}}<img class="reputation-icon" src="{{ config.images.reputation }}"></img></span>
											<span ng-if="!review.editing && canEdit(review)"> - </span>
											<a ng-click="startEditingInformation()" class="link-minor" ng-if="!review.editing && canEdit(review)"> {{ 'global.review.comment.edit' | translate }}</a>
											<a class="link-minor link-delete" ng-click="showConfirmDeleteButton()" ng-if=":delete:review.authorId == User.getUser().id && !showDelete" title="{{::translations.deleteButtonTooltip}}">{{::translations.deleteButton}}</a>
											<a class="link-minor link-delete" ng-click="deleteReview()" ng-if=":delete:review.authorId == User.getUser().id && showDelete" title="{{::translations.confirmDeleteButtonTooltip}}">{{::translations.confirmDeleteButton}}</a>
										</div>
										<div class="decklist-field" ng-if="review.plugins.hearthstone.parseDecks.reviewDeck">
											<span translate="hearthstone.review.decklist"></span>
											<span compilecontent content="review.plugins.hearthstone.parseDecks.markedReviewDeck"></span>
										</div>
									</div>
									<button class="btn btn-default ask-pro" ng-click="showProModal()" ng-if="!!coaches.length && !review.editing" title="{{ 'global.review.askProTooltip' | translate }}">{{ 'global.review.askProButton' | translate }}</button>
								</div>
								
							</div>
						</div>

						<div class="row">
							<div class="col-md-12">
								<div class="panel panel-default" ng-if="!review.editing && review.text">
									<div compilecontent content="review.markedText" class="panel-body video-description"></div>
								</div>
								<toolbar ng-if="review.editing && review.key" media-player="mediaPlayer" insert-model="insertModel" config="config" media-type="review.reviewType">
									<textarea class="form-control text-editing-area" ng-model="review.text" comment-plugins="plugins" auto-grow toolbar-target></textarea>
								</toolbar>
							</div>
						</div>
						<div class="row video-tags" ng-if="review.editing || (review.tags && review.tags.length > 0)" ng-class="{'top-spacing': review.editing}">
							<div class="col-xs-12 text-left">
								<review-tags-input review-disabled="!review.editing" review="review"></review-tags-input>
							</div>
						</div>
						<div class="row">
							<div class="col-xs-6 text-left">
								<div ng-if="review.editing">
									<button type="button" ng-click="cancelUpdateDescription()" class="btn btn-default btn-xs"><span>{{ 'global.review.comment.cancelEdit' | translate }}</span></button>
									<button type="submit" ng-click="updateDescription()" class="btn btn-default btn-xs"><span>{{ 'global.review.comment.validateEdit' | translate }}</span></button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>
	</div>
</div>

<!-- The comments -->
<div class="video-comment {{pluginNames.join(' ')}} {{review.mediaType}} {{mediaPlayer.playerControls.wideMode ? 'col-md-5' : 'col-md-7'}}" ng-class="{ 'multi-comment' : review.useV2comments }" ng-if="!restrictedAccess">
	<div class="background-white show-x">
		<div class="background-container">

			<account-claim review="::review"></account-claim>
				
			<div ng-if="selectedCoach">
				<div class="alert alert-info" translate="global.askPro.proNotified" translate-values="{name: '{{selectedCoach.name}}' }"></div>
			</div>
			<div ng-if="deletionMessage">
				<div class="alert alert-info">{{::translations.deletionDone}}</div>
			</div>

			<h3 class="comments-headline">{{::translations.commentsHeadline}}</h3>
			<div class="comments-links">
				<a class="link-minor link-nodeco" ng-click="unsubscribe()" ng-if=":reviewRefresh:(subscribed() && User.isLoggedIn())" title="{{::translations.unsubscribeReviewTooltip}}">{{::translations.unsubscribeReview}}<span class="glyphicon glyphicon-info-sign"></span></a>
				<a class="link-minor link-nodeco" ng-click="subscribe()" ng-if=":reviewRefresh:(!subscribed() && User.isLoggedIn())" title="{{::translations.subscribeReviewTooltip}}">{{::translations.subscribeReview}}<span class="glyphicon glyphicon-info-sign"></span></a>
				<a class="link-minor link-nodeco" ng-click="showProModal()" ng-if=":reviewRefresh:(!!coaches.length && !review.editing)" title="{{::translations.askProTooltip}}">{{::translations.askProButton}}</a>
			</div>

			<!-- Dropdown to sort the criteria. Don't show if in the old comment system -->
			<div ng-if="review.useV2comments" class="comment-sort-options">
				<span>{{::translations.sortedbyLabel}}</span>
				<button type="button" class="btn btn-default btn-select" data-trigger="click" data-html="1" ng-model="review.commentSortCriteria" bs-options="option.value as option.label for option in sortOptions" placeholder="{{ 'global.review.comment.sort.best' | translate }}" bs-select ng-required="true">
					<span>Action</span>
				</button>

				<label>
					<span translate="global.review.comment.sort.dampenOutOfTurnComments" title="{{ 'global.review.comment.sort.dampenOutOfTurnCommentsTitle' | translate }}"></span> <input type="checkbox" ng-model="review.dampenOutOfTurnComments">
				</label>
			</div>

			<comment-editor review="review" media-player="mediaPlayer" config="config" plugins="plugins" controller="commentEditorController"></comment-editor>

			<div class="background-container">
				<div id="comments-scrollable" scrollable="{{review.key}}">

					<div ng-if="!controlFlow.reviewDisplayed">
						<div class="loading">{{ 'global.review.loadingComments' | translate }}</span></div>
					</div>

					<div ng-if="controlFlow.reviewDisplayed">
						<comment-display review="::review" media-player="::mediaPlayer" config="::config" plugins="::plugins" sport="::sport" controller="::commentDisplayController"></comment-display>
					</div>

					<!-- Prevent scrolling center area if we're already at the bottom -->
					<div id="padder"></div>
					<div id="bottom"></div>
				</div>
			</div>
		</div>
	</div>
</div>