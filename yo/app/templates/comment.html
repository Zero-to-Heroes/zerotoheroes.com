<div class="container-fluid comment-block">
	<div class="reputation">
		<span id="upvote{{::commentIndex}}" class="glyphicon glyphicon-chevron-up pointer" ng-class="{'upvote': comment.reputation.hasCurrentUserVoted.Upvote && User.isLoggedIn()}" ng-click="::upvoteComment(comment)" aria-hidden="true" title="{{ 'global.review.comment.upvoteComment' | translate }}"></span>
		<span class="reputation-score glyphicon">{{comment.reputation.nbVotes.Upvote - comment.reputation.nbVotes.Downvote}}</span>
		<span class="glyphicon glyphicon-chevron-down pointer" ng-class="{'downvote':comment.reputation.hasCurrentUserVoted.Downvote && User.isLoggedIn()}" ng-click="::downvoteComment(comment)" aria-hidden="true" title="{{ 'global.review.comment.downvoteComment' | translate }}"></span>
	</div>
	<div class="comment-main">
		<div class="comment-header">
			<span class="author-information">
				<span class="comment-author" ng-hide="::comment.authorId">{{::comment.author}}</span>
				<author-name class="comment-author" entity="::comment" ng-show="::comment.authorId"></author-name>
				<span bs-tooltip data-title="{{::comment.author}}'s total reputation on {{::review.sport.value}}" data-placement="bottom" data-animation="am-fade-and-scale" class="total-reputation" ng-show="::comment.authorId">{{comment.authorReputation ? comment.authorReputation : 0}}<img class="reputation-icon" src="{{ config.images.reputation }}"></img></span>
			</span>

			<span title="{{::formatExactDate(comment)}}"><small>{{::formatDate(comment)}}</small></span>

			<span ng-show="comment.id && canEdit(comment) && !comment.editing"> - </span>
			<a ng-click="startEditing(comment)" class="link-minor" ng-show="comment.id && canEdit(comment) && !comment.editing">{{ 'global.review.comment.edit' | translate }}</a>
			
			<span ng-show="User.getName() == review.author && review.authorId"> - </span>
			<a ng-click="toggleHelpful(comment)" class="validated" ng-show="comment.helpful"><span class="glyphicon glyphicon-ok"></span> {{ 'global.review.comment.helpedAuthor' | translate:'{name: review.author}' }} </a>
			<a ng-click="toggleHelpful(comment)" class="link-minor" ng-show="!comment.helpful && User.getName() == review.author && review.authorId"><span class="glyphicon glyphicon-ok"></span> {{ 'global.review.comment.helpedMe' | translate }}</a>
		</div>
		<div class="comment-subheader">
			<upvoted-by sport="::sport" entity="::comment"></upvoted-by>
		</div>
		<div class="comment-body">
			<div compilecontent content="comment.markedText" ng-hide="comment.editing">
			</div>
			<div ng-show="comment.editing">
				<toolbar media-player="mediaPlayer" insert-model="insertModel" ng-show="review.key" config="config" media-type="review.replay ? 'replay' : 'video'">
					<textarea class="form-control text-editing-area" ng-model="comment.text" comment-plugins="::plugins" auto-grow toolbar-target></textarea>
				</toolbar>
				<textarea class="form-control" ng-model="comment.text" comment-plugins="::plugins" auto-grow ng-hide="review.key"></textarea>
				<div class="text-left comment-reply-buttons">
					<button ng-click="updateComment(comment)" class="btn btn-default btn-xs"><span>{{ 'global.review.comment.validateEdit' | translate }}</span></button>
					<button ng-click="cancelUpdateComment(comment)" class="btn btn-default btn-xs"><span>{{ 'global.review.comment.cancelEdit' | translate }}</span></button>
				</div>
				<div class="inline-block float-right">
					<a class="link-minor" ng-click="showHelp = true" ng-show="!showHelp">{{ 'global.review.comment.showFormattingHelpButton' | translate }}</a>
					<a class="link-minor" ng-click="showHelp = false" ng-show="showHelp">{{ 'global.review.comment.hideFormattingHelpButton' | translate }}</a>
				</div>
			</div>
		</div>
		<div class="comment-footer">
			<a ng-click="startReply()" class="link-minor" ng-hide="reply.replying">{{ 'global.review.comment.replyButton' | translate }}</a>
		</div>
	</div>
	<form ng-show="reply.replying" class="container-fluid reply-form" name="replyForm">
		<div class="row">
			<div class="col-md-2" ng-show="!User.isLoggedIn()">
				<div class="form-group" show-errors="{ showSuccess: true }">
					<input type="text" name="author" class="form-control comment-author" ng-model="reply.author" placeholder="{{ 'global.review.comment.authorNamePlaceholder' | translate }}" ng-required="!User.isLoggedIn()">
				</div>
			</div>
			<div ng-class="{'col-md-10': !User.isLoggedIn(), 'col-md-12': User.isLoggedIn()}">
				<toolbar class="form-group" show-errors="{ showSuccess: true }" media-player="mediaPlayer" insert-model="insertModel" ng-show="review.key" config="config" media-type="review.replay ? 'replay' : 'video'">
					<textarea class="form-control text-editing-area" ng-model="reply.text" name="replyText" ng-required="true" comment-plugins="plugins" auto-grow toolbar-target></textarea>
				</toolbar>
				<textarea class="form-control" ng-model="reply.text" name="replyText" ng-required="true" comment-plugins="plugins" auto-grow ng-hide="review.key"></textarea>
			</div>
		</div>
		<div class="row">
			<div class="col-md-2" ng-show="!User.isLoggedIn()"></div>
			<div ng-class="{'col-md-10': !User.isLoggedIn(), 'col-md-12': User.isLoggedIn()}">
				<div class="inline-block">
					<button ng-click="postReply()" class="btn btn-default btn-xs"><span>{{ 'global.review.comment.replyButton' | translate }}</span></button>
					<button ng-click="cancelReply()" class="btn btn-default btn-xs"><span>{{ 'global.review.comment.cancelEdit' | translate }}</span></button>
				</div>
				<div class="inline-block float-right">
					<a class="link-minor" ng-click="showHelp = true" ng-show="!showHelp">{{ 'global.review.comment.showFormattingHelpButton' | translate }}</a>
					<a class="link-minor" ng-click="showHelp = false" ng-show="showHelp">{{ 'global.review.comment.hideFormattingHelpButton' | translate }}</a>
				</div>
			</div>
		</div>
	</form>
	<div ng-show="showHelp" ng-include="'/templates/formattingHelp.html'"></div>

	<comment ng-repeat="replyComment in comment.comments" comment="replyComment" media-player="mediaPlayer" plugins="plugins" config="config"></comment>
</div>